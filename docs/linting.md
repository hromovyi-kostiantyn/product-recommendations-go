# Лінтинг коду

## Обраний лінтер

Для статичного аналізу коду в проєкті використовується **golangci-lint** — потужний лінтер для мови Go, який об'єднує в собі багато різних аналізаторів.

### Причини вибору golangci-lint:

- Об'єднує більше 50 різних лінтерів в один інструмент
- Працює швидко завдяки паралельному запуску аналізаторів
- Має гнучку систему налаштувань
- Легко інтегрується з CI/CD пайплайнами
- Активно підтримується спільнотою
- Надає детальні повідомлення про помилки

## Встановлення

```bash
# Linux або macOS
curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.57.0

# Через Go
go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.57.0
```

Перевірка встановлення:
```bash
golangci-lint --version
```

## Базові правила та їх пояснення

У файлі `.golangci.yml` налаштовано такі лінтери:

- **errcheck**: Перевіряє, що помилки оброблені належним чином
- **gosimple**: Пропонує спрощення для коду
- **govet**: Виявляє конструкції, які можуть бути помилковими
- **ineffassign**: Знаходить присвоєння, які не використовуються
- **staticcheck**: Виконує статичний аналіз з широким набором правил
- **typecheck**: Перевіряє типи та виявляє потенційні помилки
- **unused**: Знаходить невикористаний код
- **gosec**: Аналізує код на наявність вразливостей безпеки
- **gofmt**: Перевіряє форматування коду
- **goimports**: Перевіряє імпорти та їх форматування
- **misspell**: Знаходить помилки в правописі
- **revive**: Замінник golint з розширеними можливостями

## Запуск лінтера

### Ручний запуск

```bash
# Запуск для всього проєкту
golangci-lint run ./...

# Запуск для конкретного пакету
golangci-lint run ./internal/service/...

# Запуск з виведенням лише помилок (без попереджень)
golangci-lint run --no-config --disable-all --enable=errcheck,gosimple ./...
```

### Через Docker

```bash
docker-compose run lint
```

## Git hooks

Проєкт налаштований для використання pre-commit хуку, який автоматично запускає лінтер перед кожним комітом.

### Встановлення pre-commit хуку

```bash
cp scripts/hooks/pre-commit .git/hooks/
chmod +x .git/hooks/pre-commit
```

Pre-commit хук перевіряє лише змінені Go-файли для пришвидшення процесу.

## Інтеграція з процесом збірки

Лінтинг інтегровано в процес збірки Docker контейнера. Якщо лінтер виявить помилки, збірка контейнера буде перервана.

Для запуску збірки з лінтингом використовуйте:

```bash
docker-compose build
```

## Статична типізація

Go є статично типізованою мовою, тому статична перевірка типів відбувається під час компіляції. Додатково до цього, `typecheck` лінтер перевіряє правильність типів у коді.

## Комплексна перевірка коду

Для виконання комплексної перевірки коду, включаючи лінтинг, форматування, та запуск тестів, використовуйте скрипт:

```bash
./scripts/check-code.sh
```

Цей скрипт послідовно виконує:
1. Перевірку форматування коду (`gofmt`)
2. Перевірку імпортів (`goimports`)
3. Базовий аналіз коду (`go vet`)
4. Детальний статичний аналіз (`golangci-lint`)
5. Запуск тестів з вимірюванням покриття

## Рекомендації щодо написання коду

1. **Обробляйте помилки**: Завжди перевіряйте та обробляйте помилки, що повертаються функціями.
2. **Документуйте експортовані елементи**: Додавайте коментарі до всіх експортованих функцій, типів та змінних.
3. **Уникайте "магічних чисел"**: Використовуйте іменовані константи замість "магічних чисел".
4. **Використовуйте належне форматування**: Дотримуйтесь стандартного форматування Go.
5. **Видаляйте невикористаний код**: Не залишайте невикористані змінні або імпорти.
6. **Будьте обережні з замиканнями**: Уникайте використання змінних циклу в замиканнях.